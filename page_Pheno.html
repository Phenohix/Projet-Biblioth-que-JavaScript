<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library game</title>
    <link rel="stylesheet" href="src/css/style.css">
</head>

<body>
    
    <div id="PlayerTimerDiv">
        <span id="playerTimer1">owo</span>
        <span id="playerTimer2">uwu</span>
    </div>
    
    <div id="test">
        I have text for now.
    </div>
    
    <br><br>
    <div id="all">[Where all books are displayed.]</div>

    
    <div id="scene"></div>

    
</body>

<!-- // // // // // // // // // // // // // // -->

<!-- \\ \\ \\ \\ \\ JS files \\ \\ \\ \\ \\ \\ -->
<script src="src/js/delta_time_calc.js"></script>
<script src="src/js/global.js"></script>
<script src="src/js/allTimers.js"></script>
<script src="src/js/livres.js"></script>
<script src="src/js/gameManager.js"></script>
<script src="src/js/booksDisplay.js"></script>
<script src="src/js/pointsCalculator.js"></script>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="src/js/d3Elements/d3CartGoblin.js"></script>
<script src="src/js/d3Elements/d3MonsterMovement.js"></script>
<!-- \\ \\ \\ \\ \\ JS files \\ \\ \\ \\ \\ \\ -->

<script>
    // displayAll();
    var myInterval = setInterval(tick, 0);
    spawnedMonsters=[]; activeMonsters=[];
    bestiary.forEach(b => { activeMonsters[b.nom] = []; console.log(b.nom); }); console.log("activeMonsters: ", activeMonsters);
    async function spawnGoblin() {
        const monster = makeMonster(0);
        monster.group = await createCartGoblin(
            monster.position[0], monster.position[1]
        );

        spawnedMonsters.push(monster);
    }
    spawnGoblin();

    function tick() {
        delta = delta_time();
        test(delta);
        playerTimers(delta);
        globalTimer(delta);

        let monstersToDelete=[]; let monsterCounter=0;
        spawnedMonsters.forEach(m => {
            m.position=updateMonster(delta, m.velocite, m.group, m.position);
            if (m.position[0] > m.position[2]/-2) {monstersToDelete.push(copy(monsterCounter))};
            monsterCounter++;
        });
        for (let i=monstersToDelete.length-1 ; i>=0 ; i--) { spawnedMonsters.splice(monstersToDelete[i], 1); }
    }
    



    //// !ZONE DE TESTS EN BAS! ////
    /**///////// TEST MONSTER ////////
    const rc = document.getElementById("all");
    function displayBooks(monster) {
        for (k in monster["livres_voles"]) {
            book = monster["livres_voles"][k];
            rc.innerHTML += `${(k)?("<br><div>"):("<div>")}
                <p><strong>- ${book['titre']}</strong><br>
                <p>- Auteur: ${book['auteur']}<br>
                <p>- Nom: ${book['nom']}<br>
                <p>- Genre: ${book['genre']}<br>
                ${("littérature" in book)?("<p>- Littérature: "+book['littérature']+"<br>"):("")}
                <p>- Format: ${book['format']}<br>
                </div>`
        }
    }
    newMonster = makeMonster();
    rc.innerHTML = `New monster:<br>
        Nom: ${newMonster["nom"]},<br>
        Nombre de livres volés: ${newMonster["nb_livres_voles"]},<br>
        Livres volés: `;
        displayBooks(newMonster);
    rc.innerHTML += `
        Velocite: ${newMonster["velocite"]} ;
        Vitesse: ${newMonster["vitesse"]}
    `;
    //////// TEST MONSTER ////////
    //////// TEST POINTS ////////
    rc.innerHTML += `<br><br>
        Points : ${getPoints(newMonster["livres_voles"])}`
    //////// TEST POINTS ////////

</script>

</html>